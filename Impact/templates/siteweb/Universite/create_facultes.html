{% extends 'siteweb/Universite/baseU.html' %}

{% load custom_tags %}{% load custom_filters %}

{% block page %}
<!-- ======= Hero Section ======= -->
<section id="hero" class="hero">
    <div class="container position-relative">
        <div class="row gy-5" data-aos="fade-in">
            <div
                class="col-lg-12 order-2 order-lg-1 d-flex flex-column justify-content-center text-center text-lg-start">
                <h4>{{ university.name }}</h4>
                <h2>{{ faculte.name }}</h2>
            </div>
        </div>
    </div>
</section>
<!-- End Hero Section -->

<section id="secteurs-filieres" class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <form action="{% url 'create_secteurs_filieres' %}" method="post">
                {% csrf_token %}
                {% if secteurs_range %}
                {% for i in secteurs_range %}
                <div class="form-group mb-3">
                    <label for="secteur_{{ i }}_name">Nom du secteur {{ i|add_one }}</label>
                    {% with field_name="secteur_"|concat:i|stringformat:"s"|concat:"_name" %}
                    {{ form|get_item:field_name }}
                    {% endwith %}
                </div>
                <div class="form-group mb-3">
                    <label for="nombre_filieres_{{ i }}">Nombre de filières</label>
                    {% with field_name="nombre_filieres_"|concat:i|stringformat:"s" %}
                    {{ form|get_item:field_name }}
                    {% endwith %}
                </div>
                <div class="mb-3" id="filieres_container_{{ i }}"></div>
                {% endfor %}
                {% else %}
                <h4>Filières de la faculté</h4>
                <div class="form-group mb-3">
                    <label for="nombre_filieres">Nombre de filières</label>
                    {{ form.nombre_filieres }}
                </div>
                <div class="mb-3" id="filieres_container"></div>
                {% endif %}
                <button type="submit" class="btn btn-primary">Enregistrer</button>
            </form>
        </div>
    </div>
</section>

<script>
    function addFiliereFields(containerId, numFiliere, numSector) {
        let container = document.getElementById(containerId);
        container.innerHTML = '';  // Clear existing fields

        function toUpperCase(event) {
            event.target.value = event.target.value.toUpperCase();
        }

        for (let i = 0; i < numFiliere; i++) {
            let divRow = document.createElement('div');
            divRow.classList.add('form-row', 'mb-3');

            // Champ name
            let divName = document.createElement('div');
            divName.classList.add('form-group', 'col-md-8');
            if (numSector == -1) {
                let labelName = document.createElement('label');
                labelName.setAttribute('for', `filiere_${i}_name`);
                labelName.innerText = `Nom de la filière ${i + 1}`;
                let inputName = document.createElement('input');
                inputName.setAttribute('type', 'text');
                inputName.setAttribute('name', `filiere_${i}_name`);
                inputName.setAttribute('class', 'form-control');
                inputName.setAttribute('required', true);
                divName.appendChild(labelName);
                divName.appendChild(inputName);
            } else {
                let labelName = document.createElement('label');
                labelName.setAttribute('for', `filiere_${numSector}_${i}_name`);
                labelName.innerText = `Nom de la filière ${i + 1} pour le secteur ${numSector + 1}`;
                let inputName = document.createElement('input');
                inputName.setAttribute('type', 'text');
                inputName.setAttribute('name', `filiere_${numSector}_${i}_name`);
                inputName.setAttribute('class', 'form-control');
                inputName.setAttribute('required', true);
                divName.appendChild(labelName);
                divName.appendChild(inputName);
            }
            divRow.appendChild(divName);

            // champ sigle
            let divSigle = document.createElement('div');
            divSigle.classList.add('form-group', 'col');
            if (numSector == -1) {
                let labelSigle = document.createElement('label');
                labelSigle.setAttribute('for', `filiere_${i}_sigle`);
                labelSigle.innerText = `Sigle de la filière`;
                let inputSigle = document.createElement('input');
                inputSigle.setAttribute('type', 'text');
                inputSigle.setAttribute('placeholder', 'Ex: GIT');
                inputSigle.setAttribute('name', `filiere_${i}_sigle`);
                inputSigle.setAttribute('class', 'form-control');
                inputSigle.setAttribute('required', true);
                inputSigle.addEventListener('input', toUpperCase);
                divSigle.appendChild(labelSigle);
                divSigle.appendChild(inputSigle);
            } else {
                let labelSigle = document.createElement('label');
                labelSigle.setAttribute('for', `filiere_${numSector}_${i}_sigle`);
                labelSigle.innerText = `Sigle de la filière`;
                let inputSigle = document.createElement('input');
                inputSigle.setAttribute('type', 'text');
                inputSigle.setAttribute('placeholder', 'Ex: GIT');
                inputSigle.setAttribute('name', `filiere_${numSector}_${i}_sigle`);
                inputSigle.setAttribute('class', 'form-control');
                inputSigle.setAttribute('required', true);
                inputSigle.addEventListener('input', toUpperCase);
                divSigle.appendChild(labelSigle);
                divSigle.appendChild(inputSigle);
            }
            divRow.appendChild(divSigle);

            container.appendChild(divRow);
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        {% if secteurs_range %}
        {% for i in secteurs_range %}
        document.querySelector(`[name="nombre_filieres_{{ i }}"]`).addEventListener('input', function () {
            addFiliereFields('filieres_container_{{ i }}', this.value, {{ i }});
    });
    {% endfor %}
    {% else %}
    document.querySelector(`[name="nombre_filieres"]`).addEventListener('input', function () {
        addFiliereFields('filieres_container', this.value, -1);
    });
    {% endif %}
    });
</script>
{% endblock %}